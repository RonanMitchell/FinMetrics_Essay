---
output: 
 md_document:
   variant: markdown_github
---
The purpose of this README is to guide the reader through the decisions I made when writing my final Financial Econometrics research assignment (Masters in Economics). I selected the following question:

* "Study bond yield spreads - you have 10yr and 2yr bond yields. Calculate the spread and see if you can find any interesting patterns comparing yield spreads through time, linking it to VIX / currency volatility - and perhaps looking at other macro factors too."

This README will guide the reader through any code, functions, and output that was constructed for this assignment. 

# Interpretation of the Question

I have decided to focus on a comparison between South African bond yields and those of the rest of the world. I begin with descriptive data analysis, such as simply plotting the various yields - except I contextualize these yields by indicating high volatility times for the US, or EU. I also compare the distribution of yields for each country through the use of ridge lines. Finally, a visually intuitive tool - geospatial analysis - is used to convey they risk level of different countries. Once the descriptive analysis is done, I build a GARCH model. 

```{r include=FALSE, warning=FALSE}

rm(list = ls())

gc()

# General:

library(tidyverse)
library(ggplot2)
library(gridExtra)

# Ridge Plots:

library(ggridges)
library(viridis)
library(hrbrthemes)

# Geo-spatial data:

library(lwgeom)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)

```

# Required Packages:

## General

* tidyverse

## Plotting 

* ggplot2
* gridExtra

* ggridges 
* viridis 
* hrbrthemes 

* lwgeom 
* sf
* rnaturalearth 
* rnaturalearthdata


# Loading and Editing Data sets

## Importing Perscribed Data

The data sets all required similar wrangling, so I wrote a function to sort of get each data set into similar shape (Data_Creator_foo). The function essentially removes unnecessary tags from country names or bond tickers (so that I can more easily merge all sets later on), and converts to monthly yields. The reason for this is that I could only get monthly inflation from the World Bank and if I want to do some yield adjustments later on, this change might be useful. Finally, the function filters only by dates post-2010, because the SA data sets were limited to this. 

```{r}


source("code/Data_Creator_foo.R")

# 2 year Global Bonds.

Global_2yr <- 

    Data_Creator_foo(readRDS("data/BondYields_2Y.rds"),
                 
                     "_2yr",
                 
                     "2Y")

  # 10 year Global bonds.

Global_10yr <- 
    
    Data_Creator_foo(readRDS("data/BondYields_10Y.rds"),
                     
                     "_10Yr",
                     
                     "10Y")  %>%
   
   filter(Name %in% Global_2yr$Name)



  # 2 year South African (SA) bonds. 

SA_2yr <- 
    
    Data_Creator_foo(readRDS("data/BondYields_2Y_SA.rds"),
                     
                     "_2Yr", 
                     
                     "")

  # 10 Year SA bonds.

SA_10yr <- 
    
    Data_Creator_foo(readRDS("data/BondYields_10Y_SA.rds"),
                     
                     "_10Yr",
                     
                     "") 

```

The data sets all now start at the same date, and the global sets include the same bonds. At this point it is clear that we have COVID-19 Data. Perhaps we can do a sort of crisis bond yield analysis? 

The code chunk below simply demonstrates my investigation into why the data sets might include the same names and bonds now, but do not have the same dimensions. This need not usually be a huge concern, because plotting will work regardless, but I just wanted to check whether there is cause for concern. In the end, it was fine and nothing much really needed changing. In order to check the similarity of different columns in each data set, I wrote a comparison function named Similarity_Checker_foo.R. 

```{r }

# Why are the data sets different lengths? 

source("code/Similarity_Checker_foo.R")

SimilarityChecker_foo(Global_10yr, Global_2yr, "date") # same dates 
SimilarityChecker_foo(Global_10yr, Global_2yr, "Name") # same countries 

SimilarityChecker_foo(
    
    Global_10yr, Global_2yr, "Ticker"
    
    ) # different bonds but same countries? 

###

Global_2yr <- 
    
    Global_2yr %>% 
    
    filter(
        
        Ticker %in% Global_10yr$Ticker) %>% 

# Removed some but still different number of observations. 
    
    #Duplicate dates? 

 distinct(Ticker, date, .keep_all = TRUE) # no duplicate dates 

# The culprit is, it turns out: 

print(table(Global_10yr$Name))

print(table(Global_2yr$Name))

# Different countries have different starting points in terms of dates, different numbers of observations each, between the two data sets. 

```

## Merging Perscribed Data 

Because the data came in pseudo-long format, I had to write a function to easily merge future data sets, as, from my point of view, merging these data sets required some substantial but repeatable coding, wrangling and thinking. So the function now does all of this for me - Data_Merger_foo.R. 

```{r }

source("code/Data_Merger_foo.R")

###

Bonds2yr <- 

Data_Merger_foo(Global_2yr, SA_2yr, BondYield_2, "BondYield_2")

###

Bonds10yr <- 

Data_Merger_foo(Global_10yr, SA_10yr, BondYield_10, "BondYield_10")

###

rm(list = c("Global_10yr", "Global_2yr", "SA_10yr", "SA_2yr"))

```

## Search Vectors 

Below, I simply create some search/character vectors that will easily allow me to filter through the data and only plot specific regions later on. This will help for the ridge line plots, and the bond yield plots - even the inflation plots to come. Region specific analysis makes more sense to me because one can otherwise get lost in a mess of lines or distributions that exhibit less than usual (visual) co-movement, and it can be difficult to see exactly what is going on. 

```{r }

# Isolating BRCIS countries: 

BRICS <- c(
    
    "Brazil", 
          
    "CHINA", 
          
    "India", 
           
    "Russia",
    
    "ZA"
    
    )

# Developed Countries: 

Dev_Count <- c(
    
    "Canada",
    
    "France",
    
    "Germany",
    
    "Japan",
    
    "Korea",
    
    "NZ",
    
    "Singapore",
    
    "UK",
    
    "US"
    
    )

# Developing Countries: 

Developing_vec <- 
    
    unique(
  
        Bonds2yr$Name[!grepl("EURO", Bonds2yr$Name) & 
                          
                        !grepl("Venezuela", Bonds2yr$Name) &
                          
                          !Bonds2yr$Name %in% Dev_Count]
        
)

# Venezuela destroyed the aesthetics of all my graphs because their yield, inflation and distribution is insane. It was visually easier to cope if they are not in the ridge or line plots. 

```

## Non-perscribed Data 

Below I download CPI data from the World Bank. This is so that I am able to either use CPI or inflation measures from a reputable source to contextualized bond yields. Inflation is one of the only true economic risks that can face a bond - in normal times - and as such I think it is worth including in the analysis. I have also downloaded VIX and US-EU exchange rate data from FRED. 

```{r }

# world bank CPI measure, I have only downloaded since 2010. 

CPI <- read.csv("data/Inflation Data.csv") %>%
    
  `colnames<-`(sub("^X", "", colnames(.))) %>% # Excel problem
    
  mutate(Name = ifelse(Name == "China", "CHINA",
                       
                ifelse(Name == "New Zealand", "NZ",
                              
                ifelse(Name == "United Kingdom", "UK", 
                                     
                ifelse(Name == "United States", "US",
                       
                ifelse(Name == "Russian Federation", "Russia",
                       
                ifelse(Name == "Venezuela, RB", "Venezuela",
                                            
                ifelse(Name == "South Africa", "ZA", Name)
                
                ))))))) %>%
    
  filter(Name %in% Bonds2yr$Name) %>% # select same countries
    
  gather(date, CPI, -Name) %>%
    
  mutate(date = as.Date(paste0(date, "-01-01"))) %>% 
    
  arrange(Name, date) %>%
    
  group_by(Name) %>%
    
  mutate(Inflation = (CPI - lag(CPI)) / lag(CPI) * 100) %>% # inflation
    
  replace_na(list(Inflation = 0)) %>% # first date is zero inflation 
    
  mutate(CPI = (CPI - 100)) %>% 
    
  ungroup()

```

```{r}

###

# VIX monthly data from FRED:

VIX_Data <- read.csv("data/VIX Data.csv") %>%
  
    mutate(date = as.Date(date, format = "%d/%m/%Y")) %>% 
    
        filter(date <= "2022-03-31")

###

US_Exchange <- read.csv("data/US to EU Exchange.csv") %>%
  
    mutate(date = as.Date(date, format = "%d/%m/%Y")) %>% 
    
        filter(date <= "2022-03-31")

```

# Descriptive Statistics 

## Developed Nations Bond Yields & Inflation 

```{r warning = FALSE}

source("code/Yield_Plotter_foo.R")

###

grid.arrange(

Yield_Plotter(Data = Bonds10yr,
              Vec = Dev_Count, 
              y = BondYield_10,
              "Developed Nations",
              "Bond Yield (10-Year)",
              "none"),

Yield_Plotter(Data = CPI,
              Vec = Dev_Count, 
              y = Inflation,
              "",
              "Inflation",
              "bottom"),

ncol = 1)

```

## Developing Nations Bond Yields & Inflation 

```{r}

grid.arrange(

Yield_Plotter(Data = Bonds10yr,
              Vec = Developing_vec, 
              y = BondYield_10,
              "Developing Nations",
              "Bond Yield (10-Year)",
              "none"),

Yield_Plotter(Data = CPI,
              Vec = Developing_vec, 
              y = Inflation,
              "",
              "Inflation",
              "bottom"),

ncol = 1)

```

## BRICS Bond Yields & Inflation 

```{r}

grid.arrange(

Yield_Plotter(Data = Bonds10yr,
              Vec = BRICS, 
              y = BondYield_10,
              "BRICS",
              "Bond Yield (10-Year)",
              "none"),

Yield_Plotter(Data = CPI,
              Vec = BRICS, 
              y = Inflation,
              "",
              "Inflation",
              "bottom"),

ncol = 1)

```

## Ridge Plots 

```{r warning = FALSE}

source("code/Ridge_Plotter_foo.R")

###

Ridge_Plotter(Bonds10yr, 
              "ZA", 
              BondYield_10,
              BRICS,
              "Distribution of BRICS Yields")

```

```{r}

Ridge_Plotter(Bonds10yr,
              "US",
              BondYield_10, 
              Dev_Count,
              "Distribution of Developed Countries' Yields")

```

## Geospatial Plotting 

```{r warning = FALSE}

source("code/Map_Data_foo.R")

M1 <- Map_Data_foo(Bonds2yr, BondYield_2)
M2 <- Map_Data_foo(CPI, Inflation)

```

```{r warning = FALSE}

source("code/Create_Map_foo.R")

###

grid.arrange(

create_map(M1, "Average Bond Yield (2-Year)"),

create_map(M2, "Average Inflation"),

ncol = 1)

```

